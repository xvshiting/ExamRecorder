# 内容管理功能总结

## 功能概述

为数据采集系统添加了完整的本地采集内容管理界面，包括：

1. **主界面选择器** - 用户可以选择进入采集模式或管理模式
2. **数据管理界面** - 查看、搜索、筛选采集的记录
3. **回放界面** - 支持双视频同步播放和时间轴控制

## 新增文件

### 1. 主界面选择器
- **文件**: `gui/main_selector.py`
- **功能**: 
  - 提供采集/管理选择界面
  - 管理窗口生命周期
  - 优雅的窗口切换

### 2. 数据管理界面
- **文件**: `gui/data_manager_window.py`
- **功能**:
  - 显示所有采集记录
  - 时间范围搜索
  - 关键词搜索
  - 记录状态显示（✓/✗）
  - 一键回放功能

### 3. 回放界面
- **文件**: `gui/playback_window.py`
- **功能**:
  - 双视频同步播放（屏幕录制 + 摄像头录制）
  - 播放控制（播放/暂停/停止）
  - 时间轴显示
  - 采集信息展示（题目、用户输入）

## 功能特性

### 数据管理界面特性

1. **智能搜索**
   - 时间范围搜索（开始时间 - 结束时间）
   - 关键词搜索（题目内容、用户输入）
   - 实时筛选结果

2. **记录展示**
   - 采集时间
   - 题目内容（自动截断）
   - 参考答案
   - 视频文件状态（✓/✗）
   - 操作按钮

3. **数据统计**
   - 显示总记录数
   - 筛选后记录数

### 回放界面特性

1. **双视频播放**
   - 屏幕录制和摄像头录制同步播放
   - 独立的播放控制
   - 视频缩放适配

2. **播放控制**
   - 播放/暂停/停止
   - 时间显示（当前时间/总时长）
   - 自动同步

3. **信息展示**
   - 题目内容
   - 用户输入内容
   - 采集时间信息

## 技术实现

### 视频播放技术
- 使用 `cv2.VideoCapture` 读取视频
- `QThread` 实现多线程播放
- `pyqtSignal` 实现线程间通信
- 帧格式转换（BGR → RGB → QImage → QPixmap）

### 界面布局
- `QSplitter` 实现可调整大小的视频区域
- `QGroupBox` 组织功能区域
- `QTableWidget` 展示数据列表
- 响应式布局设计

### 数据管理
- 自动扫描 `data/` 目录下的 JSON 文件
- 文件存在性检查
- 按时间倒序排序
- 内存高效的数据结构

## 使用流程

### 1. 启动系统
```bash
python main.py
```

### 2. 选择功能
- 点击"数据采集"进入采集模式
- 点击"内容管理"进入管理模式

### 3. 数据管理
- 设置时间范围进行搜索
- 输入关键词进行筛选
- 点击"回放"按钮查看具体记录

### 4. 视频回放
- 查看双视频同步播放
- 使用播放控制按钮
- 查看采集信息

## 界面截图说明

### 主界面选择器
- 简洁的选择界面
- 两个主要功能按钮
- 统一的视觉风格

### 数据管理界面
- 搜索筛选区域
- 数据表格展示
- 操作按钮区域

### 回放界面
- 双视频播放区域
- 播放控制区域
- 信息展示区域

## 扩展性

### 未来可添加的功能
1. **缩略图时间轴** - 在视频下方显示缩略图时间条
2. **键盘快捷键** - 支持键盘控制播放
3. **播放速度控制** - 支持快进/慢放
4. **标注功能** - 在视频上添加标注
5. **导出功能** - 导出特定时间段的视频
6. **批量操作** - 批量删除、导出等

### 技术扩展点
1. **视频缓存** - 提高播放性能
2. **硬件加速** - 使用GPU加速视频解码
3. **网络播放** - 支持远程视频播放
4. **数据库存储** - 使用数据库替代文件存储

## 修复记录

### 2024年修复
1. **缩略图引用错误** - 修复了 `ThumbnailSlider` 无法调用 `PlaybackWindow` 方法的问题
2. **播放起始位置** - 修复了视频从5秒开始播放的问题，现在从0秒开始
3. **缩略图区域大小** - 增加了缩略图区域的高度（120-150px）和缩略图尺寸（160x90）
4. **播放控制优化** - 改进了播放按钮状态管理和时间显示
5. **播放速率修复** - 修复了视频播放过快的问题，使用正确的帧延迟控制
6. **时间轴组件重构** - 将时间轴和缩略图结合成 `TimelineWidget` 组件
7. **联动模式实现** - 支持同步调整两个视频的播放位置
8. **缩略图功能澄清** - 缩略图仅用于预览和跳转，不影响视频播放帧数

## 总结

新添加的内容管理功能大大提升了系统的实用性：

1. **用户体验** - 提供了直观的数据浏览和回放界面
2. **功能完整性** - 从采集到管理的完整工作流程
3. **技术先进性** - 使用现代化的UI设计和视频播放技术
4. **扩展性** - 为未来功能扩展奠定了良好基础

这个功能模块使得数据采集系统从一个简单的采集工具升级为一个完整的数据管理平台。 