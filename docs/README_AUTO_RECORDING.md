# 自动录制功能说明

## 功能概述

现在系统支持点击"开始"按钮时自动同时录制屏幕和webcam视频，确保两个视频具有相同的时长。系统还实现了精确的同步机制，确保两个录制过程完全同步。

## 新增功能

### 1. 自动同步录制
- 点击"开始"按钮时，系统会自动：
  - 自动开启webcam预览（如果webcam已连接）
  - 开始屏幕录制（录制输入框区域）
  - 如果webcam已连接，同时开始webcam录制
  - 支持两种webcam录制模式：
    - **录制预览框区域**（推荐）：与屏幕录制使用相同的录制机制，确保完全同步
    - **直接录制摄像头**：使用原有的webcam录制机制
  - 两个录制使用相同的时间戳和开始时间，确保完全同步

### 2. 文件命名规则
- 屏幕录制：`data/sample_{timestamp}.mp4`
- webcam录制：`data/webcam_{timestamp}.mp4`
- 数据文件：`data/sample_{timestamp}.json`

### 3. 录制状态显示
- 录制过程中，webcam录制按钮会显示"录制中..."并变为红色
- 录制状态标签会显示"自动录制中"
- 录制信息会显示"与屏幕录制同步开始"
- 自动开启webcam预览，无需手动操作
- **录制时边框变化**：输入框和webcam预览框边框都变为蓝色，清晰标识录制区域

### 4. 数据保存
- JSON文件中新增字段：
  - `screen_video_path`: 屏幕录制文件路径
  - `webcam_video_path`: webcam录制文件路径（如果录制成功）

## 使用方法

### 基本流程
1. 连接webcam设备（可选）
2. 点击"开始"按钮
3. 系统自动开始录制
4. 在输入框中输入答案
5. 点击"提交"按钮
6. 系统自动停止录制并保存文件

### 录制场景
- **有webcam连接**：同时生成屏幕录制和webcam录制两个视频
- **无webcam连接**：仅生成屏幕录制视频，会显示提示信息

## 技术实现

### 关键修改
1. `MainWindow.on_start()` 方法：
   - 生成统一的时间戳
   - 同时启动屏幕录制和webcam录制
   - 更新UI状态显示

2. `MainWindow.__init__()` 方法：
   - 新增 `webcam_video_path` 属性

3. 数据保存：
   - 修改JSON数据结构，分别保存两个视频路径
   - 更新完成提示信息

### 同步机制
- 使用相同的时间戳确保两个视频文件对应
- 使用相同的开始时间参数，确保录制过程完全同步
- **录制预览框区域模式**：使用与屏幕录制相同的mss库和帧率控制机制
- **直接录制摄像头模式**：改进的帧率控制机制，使用cv2.waitKey()进行时序控制
- 同时开始和停止录制，保证时长一致
- 统一的错误处理和状态管理

## 注意事项

1. **webcam连接**：确保webcam设备已正确连接并选择
2. **录制质量**：webcam录制帧率可在界面上调整（默认30fps）
3. **存储空间**：同时录制两个视频会占用更多存储空间
4. **性能影响**：同时录制可能对系统性能有一定影响

## 测试方法

运行测试脚本：
```bash
# 基本功能测试
python test_auto_recording.py

# 同步性测试
python test_sync_recording.py

# 预览框录制测试（推荐）
python test_preview_recording.py

# 边框效果测试
python test_border_effect.py
```

按照界面提示进行测试，检查data目录中是否生成了对应的视频文件，并验证两个视频的时长是否一致。

**推荐使用"录制预览框区域"模式以获得最佳的同步效果。** 